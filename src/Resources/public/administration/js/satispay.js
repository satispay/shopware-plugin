!function(t){var e={};function n(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(a,i,function(e){return t[e]}.bind(null,i));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/bundles/satispay/",n(n.s="qkv5")}({"2ui8":function(t,e){t.exports='{% block satispay_payment_actions_modal_refund %}\n\n    <sw-modal\n        variant="small"\n        :title="$tc(`satispay-payments.paymentDetails.modal.refund.title`)"\n        @modal-close="$emit(\'modal-close\')">\n        <sw-number-field\n            :max="refundableAmount"\n            :min="0"\n            v-model="refundAmount"\n            :label="$tc(\'satispay-payments.paymentDetails.modal.refund.amount.label\')"\n            :helpText="$tc(\'satispay-payments.paymentDetails.modal.refund.amount.helpText\')">\n            <template #suffix>\n                {{ paymentResource.currency }}\n            </template>\n        </sw-number-field>\n        <span style="font-size: 10px;">\n            {{ $tc(\'satispay-payments.paymentDetails.modal.refund.amount.helpTextEmpty\') }}\n            <br />\n            {{ $tc(\'satispay-payments.paymentDetails.modal.refund.amount.helpTextDecimals\') }}\n        </span>\n        <template #modal-footer>\n            <sw-button variant="primary"\n                       @click="refund">\n                {{ $tc(\'satispay-payments.paymentDetails.modal.refund.confirmButton\') }}\n            </sw-button>\n        </template>\n\n    </sw-modal>\n{% endblock %}\n'},AvCE:function(t,e){var n=Shopware,a=n.Component,i=n.Defaults,o=Shopware.Data.Criteria;a.register("satispay-config-restriction-saleschannel",{template:" ",inject:["repositoryFactory"],computed:{salesChannelRepository:function(){return this.repositoryFactory.create("sales_channel")}},created:function(){this.checkAndHideSetting()},updated:function(){this.checkAndHideSetting()},methods:{checkAndHideSetting:function(){var t=this.pluginConfigData().currentSalesChannelId,e=document.querySelectorAll(".sw-block-field"),n=document.querySelector(".sw-system-config--field-satispay-config-sandbox-activated-code");if(n||void 0===e[4]||(n=e[4]),n){var a=n.querySelector("div.sw-inheritance-switch");a&&(a.hidden=!0)}var r=document.querySelector(".sw-system-config--field-satispay-config-live-activated-code");if(r||void 0===e[2]||(r=e[2]),r){var s=r.querySelector("div.sw-inheritance-switch");s&&(s.hidden=!0)}var c=document.querySelectorAll('input[name^="Satispay.config"],.sw-plugin-config__save-action,.sw-plugin-config__activate-action');if(t){var p=new o;p.setPage(1),p.setLimit(500),p.addSorting(o.sort("sales_channel.name","ASC")),p.addFilter(o.equals("typeId",i.storefrontSalesChannelTypeId)),p.addFilter(o.equals("id",t)),this.salesChannelRepository.search(p,Shopware.Context.api,c).then((function(t){t&&0===t.length?c.forEach((function(t){"Satispay.config.liveActivatedCode"!==t.id&&"Satispay.config.sandboxActivatedCode"!==t.id&&t.setAttribute("disabled","disabled")})):c.forEach((function(t){"Satispay.config.liveActivatedCode"!==t.id&&"Satispay.config.sandboxActivatedCode"!==t.id&&t.removeAttribute("disabled")}))}))}else c.forEach((function(t){"Satispay.config.liveActivatedCode"!==t.id&&"Satispay.config.sandboxActivatedCode"!==t.id&&t.removeAttribute("disabled")}));var l=document.querySelectorAll('input[name="Satispay.config.sandbox"]')[0].checked,d=document.querySelector(".sw-system-config--field-satispay-config-sandbox-activation-code");d||void 0===e[3]||(d=e[3]);var u=document.querySelector(".sw-system-config--field-satispay-config-live-activation-code");u||void 0===e[1]||(u=e[1]),u&&n&&(l?(r.hidden=!0,u.hidden=!0,d.hidden=!1,n.hidden=!1):(n.hidden=!0,d.hidden=!0,u.hidden=!1,r.hidden=!1))},pluginConfigData:function(){return this.$parent.$parent.$parent.actualConfigData?this.$parent.$parent.$parent:this.$parent.$parent.$parent.$parent}}})},CnIn:function(t,e){t.exports='<template>\n    <sw-button class="sw-plugin-config__activate-action"\n            @click="onActivateClickedButton"\n    >{{ $tc(\'satispay-config.activateButton\') }}</sw-button>\n</template>\n\n'},FzWx:function(t,e){t.exports='{% block satispay_payment_actions %}\n<div>\n    <div class="satispay-payment-actions__button-container">\n        <div class="satispay-payment-actions__authorize-button-group">\n\n            {% block satispay_payment_actions_refund %}\n                <sw-button variant="primary"\n                           size="small"\n                           :disabled="notRefundable"\n                           @click="showModal = true">\n                    {{ $tc(\'satispay-payments.paymentDetails.buttons.label.refund\') }}\n                </sw-button>\n            {% endblock %}\n\n        </div>\n\n        {% block satispay_payment_actions_modal %}\n\n            {% block satispay_payment_actions_modal_refund %}\n                <satispay-payment-action-refund\n                    v-if="showModal"\n                    @modal-close="showModal=false"\n                    :order="order" :paymentResource="paymentResource">\n                </satispay-payment-action-refund>\n            {% endblock %}\n\n        {% endblock %}\n    </div>\n</div>\n{% endblock %}\n'},XtQw:function(t,e){t.exports="{% block sw_order_detail_content_tabs_general %}\n    {% parent %}\n\n    <sw-tabs-item\n        v-if=\"isSatispayPayment\"\n        :route=\"{ name: 'satispay.payment.detail', params: { id: $route.params.id } }\"\n        :title=\"$tc('satispay-payments.order-detail.tabTitle')\">\n        {{ $tc('satispay-payments.order-detail.tabTitle') }}\n    </sw-tabs-item>\n{% endblock %}\n"},kQtu:function(t,e){t.exports='{% block sw_plugin_config_actions_save %}\n     {%  parent %}\n     {% block satispay_plugin_config_actions_activate %}\n     {% endblock %}\n{% endblock %}\n{% block sw_plugin_config_content %}\n {%  parent %}\n    <sw-loader v-if="isLoading"></sw-loader>\n{% endblock %}\n\n'},kfaE:function(t){t.exports=JSON.parse('{"satispay-payments":{"general":{"mainMenuItemGeneral":"Satispay Payments","descriptionTextModule":"Satispay Payments"},"paymentDetails":{"title":"Status","buttons":{"label":{"refund":"Make a refund"}},"status":{"heading":"Payment"},"errorPage":{"title":"Error","subline":"There was an error with the fetch of the details"},"description":{"status":"Status","amount":"Amount","currency":"Currency","type":"Type","flow":"Flow"},"modal":{"refund":{"title":"Refund form","amount":{"label":"Amount","helpText":"Amount to refund for the current order. Leave empty to refund the total amount.","helpTextEmpty":"Leave empty to refund the total amount.","helpTextDecimals":"Decimals must be divided with a dot."},"confirmButton":"Perform refund"},"notification":{"success":"Refund approved","error":"An error occurred. Please retry or contact your support"}}}},"satispay-config":{"activateButton":"Activate","notification":{"success":"Activation processed","error":"An error occurred. Please retry or contact your support"}}}')},lGcs:function(t,e){t.exports='{% block satispay_payment_detail %}\n    <div class="satispay-payment-detail">\n        <div v-if="!isLoading && showPaymentDetails">\n            <sw-card :title="$tc(\'satispay-payments.paymentDetails.title\')">\n                <template #grid>\n\n                    {% block satispay_payment_actions_section %}\n                        <sw-card-section secondary slim>\n                            <satispay-payment-actions :order="order" :paymentResource="paymentTransactionData">\n                            </satispay-payment-actions>\n                        </sw-card-section>\n                    {% endblock %}\n\n                    <sw-card-section divider="top">\n                        <sw-container columns="1fr"\n                                      gap="0px 30px">\n                            <h3>\n                                  {{ $tc(\'satispay-payments.paymentDetails.status.heading\') }}\n                            </h3>\n\n                            {% block satispay_payment_detail %}\n                                <sw-description-list>\n                                    <dt>{{ $tc(\'satispay-payments.paymentDetails.description.status\') }}</dt>\n                                    <dd>{{ status }}</dd>\n                                    <dt>{{ $tc(\'satispay-payments.paymentDetails.description.amount\') }}</dt>\n                                    <dd>{{ amount }}</dd>\n                                    <dt>{{ $tc(\'satispay-payments.paymentDetails.description.currency\') }}</dt>\n                                    <dd>{{ currency }}</dd>\n                                    <dt>{{ $tc(\'satispay-payments.paymentDetails.description.flow\') }}</dt>\n                                    <dd>{{ flow }}</dd>\n                                    <dt>{{ $tc(\'satispay-payments.paymentDetails.description.type\') }}</dt>\n                                    <dd>{{ type }}</dd>\n                                </sw-description-list>\n                            {% endblock %}\n                        </sw-container>\n                    </sw-card-section>\n                </template>\n            </sw-card>\n\n        </div>\n\n        <div v-if="showError">\n            <sw-empty-state\n                :title="$tc(\'satispay-payments.paymentDetails.errorPage.title\')"\n                :subline="$tc(\'satispay-payments.paymentDetails.errorPage.subline\')"\n                icon="default-shopping-paper-bag"\n                color="#A092F0">\n            </sw-empty-state>\n        </div>\n\n        <sw-loader v-if="isLoading"></sw-loader>\n    </div>\n{% endblock %}\n'},qkv5:function(t,e,n){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=p(t);if(e){var i=p(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return c(this,n)}}function c(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}n.r(e);var l=Shopware.Classes.ApiService,d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}(p,t);var e,n,a,c=s(p);function p(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"satispay";return i(this,p),c.call(this,t,e,n)}return e=p,(n=[{key:"activate",value:function(){var t="_action/".concat(this.getApiBasePath(),"/activate");return this.httpClient.get(t,{headers:this.getBasicHeaders()}).then((function(t){return l.handleResponse(t)}))}}])&&o(e.prototype,n),a&&o(e,a),Object.defineProperty(e,"prototype",{writable:!1}),p}(l);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=g(t);if(e){var i=g(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return v(this,n)}}function v(t,e){if(e&&("object"===u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=Shopware.Classes.ApiService,w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(o,t);var e,n,a,i=h(o);function o(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"satispay";return y(this,o),i.call(this,t,e,n)}return e=o,(n=[{key:"getPaymentDetails",value:function(t,e){var n="_action/".concat(this.getApiBasePath(),"/payment-details/").concat(t,"/").concat(e);return this.httpClient.get(n,{headers:this.getBasicHeaders()}).then((function(t){return b.handleResponse(t)}))}},{key:"refundPayment",value:function(t,e,n){var a="_action/".concat(this.getApiBasePath(),"/refund-payment/").concat(t,"/").concat(e);return this.httpClient.post(a,{refundAmount:n},{headers:this.getBasicHeaders()}).then((function(t){return b.handleResponse(t)}))}}])&&f(e.prototype,n),a&&f(e,a),Object.defineProperty(e,"prototype",{writable:!1}),o}(b);Shopware.Application.addServiceProvider("SatispayConfigApiService",(function(t){var e=Shopware.Application.getContainer("init");return new d(e.httpClient,t.loginService)})),Shopware.Application.addServiceProvider("SatispayPaymentService",(function(t){var e=Shopware.Application.getContainer("init");return new w(e.httpClient,t.loginService)}));var S=n("kQtu"),_=n.n(S),A=Shopware,P=A.Component,C=A.Mixin;P.override("sw-plugin-config",{template:_.a,inject:["SatispayConfigApiService"],mixins:[C.getByName("notification")],data:function(){return{isLoading:!1}},methods:{handleErrorOnApi:function(t){try{var e=void 0!==t.response.data.error?t.response.data.error:this.$tc("satispay-config.notification.error");this.createNotificationError({title:this.$tc("global.default.error"),message:e,autoClose:!1})}finally{this.isLoading=!1}},handleApiResponse:function(){try{this.createNotificationSuccess({title:this.$tc("global.default.success"),message:this.$tc("satispay-config.notification.success")})}finally{this.isLoading=!1,window.location.reload()}},onActivateClickedButton:function(){this.isLoading=!0,this.SatispayConfigApiService.activate().then(this.handleApiResponse).catch(this.handleErrorOnApi)}}});var D=n("lGcs"),x=n.n(D),k=Shopware,O=k.Component,$=k.Mixin,j=k.Context,R=Shopware.Data.Criteria;O.register("satispay-payment-detail",{template:x.a,inject:["SatispayPaymentService","repositoryFactory"],mixins:[$.getByName("notification")],data:function(){return{isLoading:!0,showPaymentDetails:!1,order:null,satispayTransactionId:null,paymentTransactionData:null,currency:null,status:null,flow:null,type:null}},computed:{showError:function(){return!1===this.isLoading&&!1===this.showPaymentDetails},amount:function(){return this.paymentTransactionData?this.paymentTransactionData.amount_unit/100:0}},created:function(){this.createdComponent()},methods:{handleErrorOnApi:function(t){try{this.createNotificationError({title:this.$tc("satispay-payments.paymentDetails.errorPage.title"),message:t.response.data.errors[0].detail,autoClose:!1})}finally{this.isLoading=!1,this.showPaymentDetails=!1}},createdComponent:function(){var t=this,e=this.$route.params.id,n=this.repositoryFactory.create("order"),a=new R(1,1);a.getAssociation("transactions").addSorting(R.sort("createdAt")),n.get(e,j.api,a).then((function(e){t.order=e;var n=e.transactions.length-1;if(null===e.transactions[n].customFields||void 0===e.transactions[n].customFields.satispay_payment_id)return t.isLoading=!1,void(t.showPaymentDetails=!1);var a=e.transactions[n].customFields.satispay_payment_id;t.showPaymentDetails=!0,t.SatispayPaymentService.getPaymentDetails(t.order.id,a).then((function(e){t.paymentTransactionData=e,t.status=t.paymentTransactionData.status,t.currency=t.paymentTransactionData.currency,t.flow=t.paymentTransactionData.flow,t.type=t.paymentTransactionData.type,t.isLoading=!1})).catch(t.handleErrorOnApi)})).catch(this.handleErrorOnApi)}}});var E=n("FzWx"),T=n.n(E),L=n("2ui8"),B=n.n(L),M=Shopware,F=M.Component,q=M.Mixin;F.register("satispay-payment-action-refund",{template:B.a,inject:["SatispayPaymentService"],mixins:[q.getByName("notification")],props:{paymentResource:{type:Object,required:!0},order:{type:Object,required:!0}},data:function(){return{refundableAmount:0,refundAmount:0,isLoading:!1}},created:function(){this.paymentResource&&(this.refundableAmount=this.paymentResource.amount_unit/100)},methods:{handleErrorOnApi:function(t){try{var e=void 0!==t.response.data.error?t.response.data.error:this.$tc("satispay-payments.paymentDetails.modal.notification.error");this.createNotificationError({title:this.$tc("satispay-payments.paymentDetails.errorPage.title"),message:e,autoClose:!1})}finally{this.isLoading=!1,this.showPaymentDetails=!1,this.$emit("modal-close")}},handleApiResponse:function(){try{this.createNotificationSuccess({title:this.$tc("global.default.success"),message:this.$tc("satispay-payments.paymentDetails.modal.notification.success")})}finally{this.isLoading=!1,this.showPaymentDetails=!0,this.$emit("modal-close")}},refund:function(){this.isLoading=!0;var t=this.order.transactions.length-1,e=this.order.transactions[t].customFields.satispay_payment_id,n=0===this.refundAmount?this.refundableAmount:this.refundAmount;this.SatispayPaymentService.refundPayment(this.order.id,e,n).then(this.handleApiResponse).catch(this.handleErrorOnApi)}}}),Shopware.Component.register("satispay-payment-actions",{template:T.a,data:function(){return{showModal:!1}},props:{paymentResource:{type:Object,required:!0},order:{type:Object,required:!0}},computed:{notRefundable:function(){var t=this.order.transactions.length-1,e=this.order.transactions[t].stateMachineState.technicalName,n=["paid","paid_partially","refunded"].indexOf(e)>-1;return this.paymentResource.amount_unit<=0||"ACCEPTED"!=this.paymentResource.status||!n}}});var N=n("kfaE");Shopware.Module.register("satispay-payment",{type:"plugin",name:"SatispayPayments",title:"satispay-payments.general.mainMenuItemGeneral",description:"satispay-payments.general.descriptionTextModule",version:"1.0.0",targetVersion:"1.0.0",color:"#333",icon:"default-action-settings",snippets:{"en-GB":N},routeMiddleware:function(t,e){"sw.order.detail"===e.name&&e.children.push({component:"satispay-payment-detail",name:"satispay.payment.detail",isChildren:!0,path:"/sw/order/satispay/detail/:id",meta:{parentPath:"sw.order.index"}}),t(e)}});n("AvCE");var I=n("CnIn"),z=n.n(I),H=Shopware,G=H.Component,Q=H.Mixin;G.register("satispay-config-check-button",{template:z.a,inject:["SatispayConfigApiService"],mixins:[Q.getByName("notification")],data:function(){return{isLoading:!1}},methods:{handleErrorOnApi:function(t){try{var e=void 0!==t.response.data.error?t.response.data.error:this.$tc("satispay-config.notification.error");this.createNotificationError({title:this.$tc("global.default.error"),message:e,autoClose:!1})}finally{this.isLoading=!1}},handleApiResponse:function(){try{this.createNotificationSuccess({title:this.$tc("global.default.success"),message:this.$tc("satispay-config.notification.success")})}finally{this.isLoading=!1,window.location.reload()}},onActivateClickedButton:function(){this.isLoading=!0,this.SatispayConfigApiService.activate().then(this.handleApiResponse).catch(this.handleErrorOnApi)}}});var W=n("XtQw"),X=n.n(W),J=Shopware,V=J.Component,K=J.Context,U=Shopware.Data.Criteria;V.override("sw-order-detail",{template:X.a,inject:["repositoryFactory"],data:function(){return{isSatispayPayment:!1}},created:function(){this.initializeSatispay()},methods:{initializeSatispay:function(){var t=this,e=this.orderId,n=this.repositoryFactory.create("order"),a=new U(1,1);a.getAssociation("transactions").addSorting(U.sort("createdAt")),n.get(e,K.api,a).then((function(e){var n=e.transactions.length-1;null!==e.transactions[n].customFields&&void 0!==e.transactions[n].customFields.satispay_payment_id?t.isSatispayPayment=!0:t.isSatispayPayment=!1}))}}})}});